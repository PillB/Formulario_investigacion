%% Diagrama ER de la arquitectura de datos normalizada para el sistema de casos de fraude

erDiagram
  CASOS {
    string case_id PK "Identificador único del caso"
    string tipo_informe "Tipo de informe (Gerencia, Interno, Credicorp)"
    string categoria1 "Categoría de fraude – Nivel 1"
    string categoria2 "Categoría de fraude – Nivel 2"
    string modalidad "Modalidad de fraude"
    string canal "Canal de ocurrencia"
    string proceso "Proceso impactado"
  }

  CLIENTES {
    string id_cliente PK "Identificador del cliente"
    string case_id FK "Caso asociado"
    string tipo_id "Tipo de documento (DNI, RUC, Pasaporte, etc.)"
    string flag "Rol del cliente (Involucrado/Afectado/No aplica)"
  }

  CLIENT_PHONES {
    string id_cliente FK "Identificador del cliente"
    string telefono "Número de teléfono"
  }

  CLIENT_EMAILS {
    string id_cliente FK
    string correo "Dirección de correo electrónico"
  }

  CLIENT_ADDRESSES {
    string id_cliente FK
    string direccion "Dirección física"
  }

  TEAM_MEMBERS {
    string id_colaborador PK "ID del colaborador"
    string case_id FK "Caso asociado"
    string flag "Rol (Involucrado/Relacionado/No aplica)"
    string division "División"
    string area "Área"
    string servicio "Servicio"
    string puesto "Puesto"
    string nombre_agencia "Nombre de agencia (si aplica)"
    string codigo_agencia "Código de agencia (si aplica)"
    string tipo_falta "Tipo de falta"
    string tipo_sancion "Tipo de sanción"
  }

  PRODUCTS {
    string id_producto PK "Identificador del producto"
    string case_id FK "Caso asociado"
    string id_cliente FK "Cliente propietario"
    string categoria1 "Categoría Nivel 1 (override)"
    string categoria2 "Categoría Nivel 2 (override)"
    string modalidad "Modalidad (override)"
    string canal "Canal (override)"
    string proceso "Proceso impactado (override)"
    date fecha_ocurrencia "Fecha de ocurrencia"
    date fecha_descubrimiento "Fecha de descubrimiento"
    float monto_investigado "Monto investigado"
    string tipo_moneda "Tipo de moneda"
    float monto_perdida_fraude "Monto de pérdida de fraude"
    float monto_falla_procesos "Monto de falla en procesos"
    float monto_contingencia "Monto de contingencia"
    float monto_recuperado "Monto recuperado"
    float monto_pago_deuda "Monto de pago de deuda"
    string tipo_producto "Tipo de producto"
  }

  PRODUCT_CLAIMS {
    string id_reclamo PK "Identificador del reclamo"
    string case_id FK "Caso asociado"
    string id_producto FK "Producto asociado"
    string nombre_analitica "Nombre de analítica contable"
    string codigo_analitica "Código de analítica contable"
  }

  ACCIONADO {
    string id_producto FK
    string case_id FK
    string accionado "Tribu o entidad accionada"
  }

  INVOLVEMENT {
    string id_producto FK
    string case_id FK
    string id_colaborador FK
    float monto_asignado "Monto asignado al colaborador"
  }

  RISK_DETAILS {
    string risk_id PK "ID del riesgo (RSK-xxxxxx)"
    string case_id FK "Caso asociado"
    string lider "Líder del riesgo"
    string descripcion "Descripción del riesgo"
    string criticidad "Nivel de criticidad"
    float exposicion_residual "Exposición residual (US$)"
  }

  RISK_PLANS {
    string risk_id FK
    string case_id FK
    string plan_id "ID del plan de acción"
  }

  NORM_DETAILS {
    string norm_id PK "Número de norma (XXXX.XXX.XX.XX o generado)"
    string case_id FK
    string descripcion "Descripción de la norma"
    date fecha_vigencia "Fecha de vigencia"
  }

  ANALYSIS {
    string case_id FK
    string antecedentes
    string modus_operandi
    string hallazgos
    string descargos
    string conclusiones
    string recomendaciones
  }

  CASOS ||--o{ CLIENTES : contiene
  CASOS ||--o{ TEAM_MEMBERS : tiene
  CASOS ||--o{ PRODUCTS : incluye
  CASOS ||--o{ RISK_DETAILS : identifica
  CASOS ||--o{ NORM_DETAILS : transgrede
  RISK_DETAILS ||--o{ RISK_PLANS : "tiene planes"
  CASOS ||--o{ ANALYSIS : documenta
  CLIENTES ||--o{ CLIENT_PHONES : "tiene teléfonos"
  CLIENTES ||--o{ CLIENT_EMAILS : "tiene correos"
  CLIENTES ||--o{ CLIENT_ADDRESSES : "tiene direcciones"
  CLIENTES ||--o{ PRODUCTS : posee
  TEAM_MEMBERS ||--o{ INVOLVEMENT : participa
  PRODUCTS ||--o{ INVOLVEMENT : "asigna colaboradores"
  PRODUCTS ||--o{ PRODUCT_CLAIMS : "origina reclamos"
  PRODUCTS ||--o{ ACCIONADO : "accionado por"

%% Diagrama de flujo operativo para autosave, exportación y espejado
flowchart LR
  subgraph Local_Workstation ["Local workstation storage"]
    direction TB
    FCA["FraudCaseApp\n(runtime local)\nGestiona autosave y export"]
    BASE[("BASE_DIR\nAutosave drafts\nSolo local")]
    EXPORT[("Carpeta de exportación elegida por el usuario\nReportes definitivos\nSolo local hasta que se replique")]
  end

  subgraph External_Drive ["External drive mirror\n(duplicado configurable)"]
    direction TB
    EXT_LOGS[("external drive/logs\nCopia duplicada de logs")]
    EXT_TEMP[("external drive/temp\nSnapshot temporal duplicado")]
    EXT_REPORT[("external drive/reports\nDuplicado de reportes finales")]
  end

  FCA -->|"Autosave continuo"| BASE
  FCA -->|"Exporta bundle final"| EXPORT
  FCA -->|"Replica logs"| EXT_LOGS
  FCA -->|"Replica temporales"| EXT_TEMP
  EXPORT -->|"Sincronización/mirroring"| EXT_REPORT

  note over BASE,EXPORT : "Artefactos locales únicos"
  note over EXT_LOGS,EXT_TEMP,EXT_REPORT : "Artefactos duplicados en unidad externa; DevOps puede remapear la ruta vía settings.EXTERNAL_DRIVE_ROOT"

