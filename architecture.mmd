%% Diagramas de arquitectura y flujos de artefactos
%% Actualizado automáticamente el 2025-12-10 05:06:04
%%{init: { 'fontFamily': 'Noto Sans, DejaVu Sans, Segoe UI, Arial, sans-serif', 'themeVariables': { 'fontFamily': 'Noto Sans, DejaVu Sans, Segoe UI, Arial, sans-serif' } } }%%

erDiagram
  CASOS {
    string id_caso
    string tipo_informe
    string categoria1
    string categoria2
    string modalidad
    string canal
    string proceso
    string fecha_de_ocurrencia
    string fecha_de_descubrimiento
    string centro_costos
    string matricula_investigador
    string investigador_nombre
    string investigador_cargo
  }
  LLAVE_TECNICA {
    string id_caso
    string tipo_informe
    string categoria1
    string categoria2
    string modalidad
    string canal
    string proceso
    string fecha_de_ocurrencia
    string fecha_de_descubrimiento
    string centro_costos
    string matricula_investigador
    string investigador_nombre
    string investigador_cargo
    string id_producto
    string id_cliente
    string id_colaborador
    string id_reclamo
    string fecha_ocurrencia
  }
  EVENTOS {
    string id_caso
    string tipo_informe
    string categoria1
    string categoria2
    string modalidad
    string canal
    string proceso
    string fecha_de_ocurrencia
    string fecha_de_descubrimiento
    string centro_costos
    string matricula_investigador
    string investigador_nombre
    string investigador_cargo
    string id_producto
    string id_cliente
    string id_colaborador
    string id_reclamo
    string fecha_ocurrencia
    string fecha_descubrimiento
    string tipo_producto
    string tipo_moneda
    string monto_investigado
    string monto_perdida_fraude
    string monto_falla_procesos
    string monto_contingencia
    string monto_recuperado
    string monto_pago_deuda
    string nombre_analitica
    string codigo_analitica
    string cliente_nombres
    string cliente_apellidos
    string cliente_tipo_id
    string cliente_flag
    string cliente_telefonos
    string cliente_correos
    string cliente_direcciones
    string cliente_accionado
    string colaborador_flag
    string colaborador_nombres
    string colaborador_apellidos
    string colaborador_division
    string colaborador_area
    string colaborador_servicio
    string colaborador_puesto
    string colaborador_fecha_carta_inmediatez
    string colaborador_fecha_carta_renuncia
    string colaborador_nombre_agencia
    string colaborador_codigo_agencia
    string colaborador_tipo_falta
    string colaborador_tipo_sancion
    string monto_asignado
  }
  CLIENTES {
    string id_cliente
    string id_caso
    string nombres
    string apellidos
    string tipo_id
    string flag
    string telefonos
    string correos
    string direcciones
    string accionado
  }
  COLABORADORES {
    string id_colaborador
    string id_caso
    string flag
    string nombres
    string apellidos
    string division
    string area
    string servicio
    string puesto
    string fecha_carta_inmediatez
    string fecha_carta_renuncia
    string nombre_agencia
    string codigo_agencia
    string tipo_falta
    string tipo_sancion
  }
  PRODUCTOS {
    string id_producto
    string id_caso
    string id_cliente
    string categoria1
    string categoria2
    string modalidad
    string canal
    string proceso
    string fecha_ocurrencia
    string fecha_descubrimiento
    string monto_investigado
    string tipo_moneda
    string monto_perdida_fraude
    string monto_falla_procesos
    string monto_contingencia
    string monto_recuperado
    string monto_pago_deuda
    string tipo_producto
  }
  PRODUCTO_RECLAMO {
    string id_reclamo
    string id_caso
    string id_producto
    string nombre_analitica
    string codigo_analitica
  }
  INVOLUCRAMIENTO {
    string id_producto
    string id_caso
    string id_colaborador
    string monto_asignado
  }
  DETALLES_RIESGO {
    string id_riesgo
    string id_caso
    string lider
    string descripcion
    string criticidad
    string exposicion_residual
    string planes_accion
  }
  DETALLES_NORMA {
    string id_norma
    string id_caso
    string descripcion
    string fecha_vigencia
  }
  ANALISIS {
    string id_caso
    string antecedentes
    string modus_operandi
    string hallazgos
    string descargos
    string conclusiones
    string recomendaciones
  }
  LOGS {
    string timestamp
    string tipo
    string subtipo
    string widget_id
    string coords
    string mensaje
  }

  CASOS ||--o{ ANALISIS : contiene
  CASOS ||--o{ CLIENTES : contiene
  CASOS ||--o{ COLABORADORES : contiene
  CASOS ||--o{ DETALLES_NORMA : contiene
  CASOS ||--o{ DETALLES_RIESGO : contiene
  CASOS ||--o{ EVENTOS : contiene
  CASOS ||--o{ INVOLUCRAMIENTO : contiene
  CASOS ||--o{ LLAVE_TECNICA : contiene
  CASOS ||--o{ PRODUCTOS : contiene
  CASOS ||--o{ PRODUCTO_RECLAMO : contiene
  CLIENTES ||--o{ EVENTOS : id_cliente
  CLIENTES ||--o{ LLAVE_TECNICA : id_cliente
  CLIENTES ||--o{ PRODUCTOS : id_cliente
  COLABORADORES ||--o{ EVENTOS : id_colaborador
  COLABORADORES ||--o{ INVOLUCRAMIENTO : id_colaborador
  COLABORADORES ||--o{ LLAVE_TECNICA : id_colaborador
  PRODUCTOS ||--o{ EVENTOS : id_producto
  PRODUCTOS ||--o{ INVOLUCRAMIENTO : id_producto
  PRODUCTOS ||--o{ LLAVE_TECNICA : id_producto
  PRODUCTOS ||--o{ PRODUCTO_RECLAMO : id_producto

%% Notas de almacenamiento de logs:
%% - Los eventos del formulario se escriben en `logs.csv` (carpeta local) y se espejan a `external drive/logs.csv`.
%% - Si `STORE_LOGS_LOCALLY` es `False`, la bitácora sólo se persistirá en la unidad externa y se reportarán advertencias si alguno de los destinos falla.

%% Diagrama de flujo del manejo de artefactos entre la app y los destinos locales/externos
flowchart LR
  subgraph UI[App Python Tkinter GUI]
    U1[Notebook<br/>(Caso/Clientes/Colaboradores/Productos)]
    U2[Riesgos y Normas]
    U3[Análisis]
    U4[Acciones & Resumen]
  end

  subgraph Validaciones
    V1[Validación por campo<br/>(fechas, montos, IDs, condicionales)]
    V2[Revisión de duplicados<br/>case+producto+cliente+team+fecha+reclamo]
  end

  subgraph Persistencia
    P1[autosave.json]
    P2[temp versions]
    P3[exports/ (CSV, JSON, MD, DOCX)]
    P4[external drive/<case>/]
    P5[logs.csv]
  end

  UI -->|Edición dispara| V1
  UI -->|Guardar y enviar| V2
  V1 -->|Errores a usuario| UI
  V2 -->|Bloquea duplicados| UI

  UI -->|Autosave| P1
  UI -->|Autosave incremental| P2
  UI -->|Exportadores| P3
  UI -->|Espejo| P4
  UI -->|Bitácora| P5

  P3 -->|Replica| P4
  P5 -->|Replica| P4
